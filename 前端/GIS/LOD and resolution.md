## 一、LOD
在GIS系统中，不断放大，就能看到更多地图细节，了解更加详细的信息。对于GIS引擎的开发者而言，需要实现这项技术，当发现用户放大地图时，就立马使用更有细节的地图图片，替换现在显示的地图图片。

## 二、网片计算
不同环境条件下，加载具有不同细节的图片资源，可以提高效率，但这并不是终点。 瓦片技术可以更进一步提高效率。 其原理是将一张大图片切割成很多张小图片，按照呈现需要，加载其中的几张小图片即可。

![万能网片加载](E:/FigureBed/lod.png)


在WebGIS中，上一层级的一张瓦片在更大一层级中会用4张瓦片来表示。这样可以做到维持正方形的投影方式不变，同时按照2的幂次方放大，计算效率非常高。

计算：

通过上面切片的介绍，我们可以对每一层级瓦片的数量进行简单的计算。 层级0的瓦片数是
$$
total_0 = 2^0*2^0
$$
层级1的网片数是
$$
total_1 = 2^1*2^1
$$
故，层级n的瓦片数是
$$
total_n = 2^n*2^n
$$
这个地方计算的是所有瓦片数，因为是一个正方形，所以是边长的平方，如只计算`x`轴或者`y`轴一边的瓦片数，就是
$$
total_x = 2^n (total_y = 2^n)
$$


## 三、分辨率Resolution

分辨率是屏幕坐标和世界坐标的纽带，通过它，才能知道你在屏幕上用鼠标点击的位置对应于世界地图具体的经纬度位置。 当然你不用自己来做这个计算，OpenLayers3的`ol.Map`已提供了对应的方法`getCoordinateFromPixel`来帮助你实现坐标转换。

每一个层级，会使用不同的瓦片数来表示整个地球，那么无论是哪一个层级，所表示的实际地理空间范围都是一致的。但使用的瓦片个数却是不一样的，以Google在线地图为例，层级0使用了一个瓦片，层级1使用了4个瓦片。通过计算可以知道层级0整个地球图像为$256\times256$像素大小，层级1整个地球图像为$512\times512$像素大小。但是，层级0和层级1所表示的地球的范围都是一样的经度$[-180,180]$，纬度$[-90,90]$。在层级0的时候，一个像素就表示$\frac{360}{256}=1.40625$这么长的经度范围，$\frac{180}{256}=0.73125$这么长的纬度范围，这两个数字即为分辨率。

## 四、墨卡托投影坐标系下的分辨率
在WebGIS中使用的在线瓦片地图采用的是墨卡托(Mercator)投影坐标系，经过投影后，整个地球是一个正方形，所能表示的范围为经度`$[-180, 180]$`，纬度`$[-85, 85]$`，单位为度(墨卡托只是简单的把地球球面剖开拉伸为一个正方形而来，由于南北极两端采用这种拉伸会严重变形，并且南北极在使用过程中很少用到，所以干脆就只投影了`$[-85, 85]$`纬度范围的地球)。

地球赤道半径为6378137米，如赤道周长为
$$
per = 2 * \pi * r = 2 \times 3.1415926 \times 6378137=20,037,507.3631725 m
$$
所以x方向上范围为$[-20037508.3427892, 20037508.3427892]$。又因为墨卡托投影最终图形为正方形，所以y方向上的范围与x方向上范围是相同的。

我们有了范围之后，可以按照以下公式计算分辨率(以google在线瓦片地图为例)：


$$
resolution = \frac{rangerX}{256 \times 2 ^ {level}}
$$
其中`rangeX`表示x方向上整个范围，即：$20037508.3427892−(−20037508.3427892)$，256表示一个瓦片的宽度，单位为像素，$2^{level}$表示在层级`level`下，x方向上的网片个数。最终就可以计算出每个像素可以显示实际地理位置的范围，也就是分辨率。  